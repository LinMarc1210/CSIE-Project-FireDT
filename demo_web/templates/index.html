<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Fire-DT 室內火災模擬系統</title>
        <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link
            href="{{ url_for('static', filename='css/styles.css') }}"
            rel="stylesheet"
        />

    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="#page-top">Fire-Dt</a>
    <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" 
            type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" 
            aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#introduction">系統簡介</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#help">使用說明</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#portfolio">檔案上傳</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#about">回傳成果</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="login">登入</a>
        </li>

    </div>
  </div>
</nav>
<!-- Masthead-->
<header class="masthead bg-primary text-white text-center">
    <div class="container d-flex align-items-center flex-column">
        <!-- Masthead Avatar Image-->
        <div class="masthead-avatar mb-5">
            <i class="fas fa-fire fa-8x mb-5 animated-fire"></i>
        </div>

                <!-- Masthead Heading-->
                <h1 class="masthead-heading text-uppercase mb-0">Fire-Dt</h1>
                <!-- Icon Divider-->
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <!-- Masthead Subheading-->
                <h1 class="masthead-subheading font-weight-light mb-0">室內火災模擬系統</p>
            </div>
        </header>
        <!-- Portfolio Section-->
        <!-- 把這一段替換原來的 Portfolio -->
        
        <!-- Project Introduction Section-->
        <section class="page-section introduction bg-light" id="introduction">
            <div class="container">
                <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">系統簡介</h2>
                <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-info-circle"></i></div>
                    <div class="divider-custom-line"></div>
                </div>

                <div id="introCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-touch="true">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#introCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
                        <button type="button" data-bs-target="#introCarousel" data-bs-slide-to="1"></button>
                        <button type="button" data-bs-target="#introCarousel" data-bs-slide-to="2"></button>
                    </div>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="card intro-card mx-auto d-flex flex-column flex-md-row">
                              <div class="card-body image-container d-flex justify-content-center align-items-center">
                                <img src="{{ url_for('static', filename='assets/img/introduction/coor.png') }}" class="card-img-top" alt="展示1" />
                              </div>
                              <div class="card-body text-center d-flex flex-column justify-content-center align-items-center">
                                  <h3 class="card-title">座標系轉換</h3>
                                  <p class="card-text">將 Intel RealSense D435 所拍攝之點雲透過線性轉換，得到更精確的世界座標</p>
                              </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="card intro-card mx-auto d-flex flex-column flex-md-row">
                              <div class="card-body image-container d-flex justify-content-center align-items-center">
                                <img src="{{ url_for('static', filename='assets/img/introduction/seg.png') }}" class="card-img-top" alt="展示2" />
                              </div>
                              <div class="card-body text-center d-flex flex-column justify-content-center align-items-center">
                                  <h3 class="card-title">材質語義分割</h3>
                                  <p class="card-text">利用深度學習模型結合條件隨機場演算法，清楚分割 23 種表面材質</p>
                              </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="card intro-card mx-auto d-flex flex-column flex-md-row">
                              <div class="card-body image-container d-flex justify-content-center align-items-center">
                                <img src="{{ url_for('static', filename='assets/img/introduction/fds_soot.png') }}" class="card-img-top" alt="展示3" />
                              </div>
                              <div class="card-body text-center d-flex flex-column justify-content-center align-items-center">
                                  <h3 class="card-title">FDS 室內火災模擬</h3>
                                  <p class="card-text">自動生成火災動力學模擬軟體：FDS 的模擬用腳本，客製化還原室內火災發展過程。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#introCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#introCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </section>

        <section class="page-section help bg-secondary" id="help">
            <div class="container">
                <h2 class="page-section-heading text-center text-uppercase text-white mb-0">使用說明</h2>
                <div class="divider-custom divider-light mb-4">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fa-solid fa-check-to-slot"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <div class="help-item bg-light">
                    <h3 class="text-center">檔案上傳</h3>
                    <p class="text-center"><b>目前系統支援上傳 Intel RealSense D435 之 RGB-D 影像檔案(.bag) 上傳</b>，將影像檔案上傳至系統後，系統將自動進行處理</p>
                </div>
                <div class="help-item bg-light">
                    <h3 class="text-center">處理過程</h3>
                    <p class="text-center">系統將在過程中顯示進度條，提供使用者得知進度<br><b>HINT：隨著模擬秒數增加，最後的FDS模擬時程將會變長很多</b></p>
                </div>
                <div class="help-item bg-light">
                    <h3 class="text-center">回傳結果</h3>
                    <p class="text-center">系統將會回傳火源燃燒的溫度變化過程，以及煙霧擴散的過程給使用者</p>
                </div>
                <div class="help-item bg-light">
                    <h3 class="text-center">歷史紀錄</h3>
                    <p class="text-center">註冊帳號，儲存過去模擬的結果！</p>
                </div>
            </div>

        </section>

        <section class="page-section portfolio" id="portfolio">
          <div class="container">
            <!-- 區塊標題 -->
            <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">
              上傳檔案
            </h2>
            <!-- 分隔線 -->
            <div class="divider-custom mb-5">
              <div class="divider-custom-line"></div>
              <div class="divider-custom-icon"><i class="fas fa-upload"></i></div>
              <div class="divider-custom-line"></div>
            </div>

            <!-- 上傳表單（Bootstrap 5 版本） -->
            <div class="row justify-content-center">
              <div class="col-lg-8">
                <form
                  action="{{ url_for('upload_files') }}"
                  method="post"
                  enctype="multipart/form-data"
                  class="text-center"
                >
                  <!-- ❶ 檔案輸入框：加上 form-control 使其套用 Bootstrap 樣式 -->
                  <div class="mb-3">
                    <label for="fileInput" class="form-label">選擇檔案</label>
                    <input
                      class="form-control"
                      type="file"
                      id="fileInput"
                      name="files"
                      multiple
                    />
                    <div class="form-text">可同時選擇多個檔案上傳</div>
                  </div>

                  <!-- ❷ 上傳按鈕：加上 btn btn-primary btn-lg，使按鈕符合主題 -->
                  <button
                    id="upload-button"
                    type="submit"
                    class="btn btn-primary btn-lg"
                  >
                    <i class="fas fa-cloud-upload-alt me-2"></i>開始上傳
                  </button>
                  <button id="loading-button" class="btn btn-primary" type="button" style="display: none;">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Loading...
                  </button>
                </form>

                <!-- 檔案預覽列表（可留著，如果要動態顯示檔案清單） -->
                <ul id="fileList" class="list-group mt-4"></ul>
              </div>
            </div>
          </div>
        </section>


 <!-- About Section (回傳成果區) -->

    <section class="page-section bg-secondary text-white mb-0" id="about">
      <div class="container">
        <!-- 區塊標題 -->
        <h2 class="page-section-heading text-center text-uppercase text-white">
          回傳成果
        </h2>
        <!-- 分隔線 -->
        <div class="divider-custom divider-light mb-4">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-exchange-alt"></i></div>
          <div class="divider-custom-line"></div>
        </div>

        <!-- 只有在後端有 video_url 時，才顯示 <video> 播放器 -->
<!-- 在模板中顯示兩個影片 -->
{% if video_urls %}
<!-- 顯示兩個影片並排 -->
<div class="video-container">
    <div class="video-item d-flex j">
        <h2 class="text-white text-center">室內溫度變化</h2>
        <video controls>
            <source src="{{ video_urls['video1'] }}" type="video/mp4">
            您的瀏覽器不支援 HTML5 影片。
        </video>
    </div>

    <div class="video-item d-flex">
        <h2 class="text-white text-center">室內煙霧流動</h2>
        <video controls>
            <source src="{{ video_urls['video2'] }}" type="video/mp4">
            您的瀏覽器不支援 HTML5 影片。
        </video>
    </div>
</div>

{% endif %}
      </div>
    </section>

        
        <!-- Footer-->
        <footer class="footer text-center">
            <div class="container">
                <div class="row">
                    <!-- Footer Location-->
                    <div class="col-lg-4 mb-5 mb-lg-0">
                        <h4 class="text-uppercase mb-4">Location</h4>
                        <p class="lead mb-0">
                            NCKU CSIE CPS LAB
                            <br />
                            
                        </p>
                    </div>
                    <!-- Footer Social Icons-->
                    <div class="col-lg-4 mb-5 mb-lg-0">
                        <h4 class="text-uppercase mb-4">Around the Web</h4>
                    </div>
                    <!-- Footer About Text-->
                    <div class="col-lg-4">
                        <h4 class="text-uppercase mb-4">About Fire-Dt</h4>
                        <p class="lead mb-0">
                            
                        </p>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Copyright Section-->
        <div class="copyright py-4 text-center text-white">
            <div class="container"><small>Copyright &copy; Fire-Dt 2025</small></div>
        </div>

        
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script
            src="{{ url_for('static', filename='js/index.js') }}"
        ></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
        <script>
            const fileInput = document.getElementById('fileInput');
            const fileList = document.getElementById('fileList');
            const uploadBtn = document.getElementById('uploadBtn');


            
            const serverAddress = "https://electric-quietly-antelope.ngrok-free.app";

            // 監聽檔案選擇，渲染清單
            fileInput.addEventListener('change', () => {
                fileList.innerHTML = '';
                Array.from(fileInput.files).forEach(file => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `
                    <div>
                        <i class="fas fa-file me-2"></i>${file.name}
                    </div>
                    <span class="badge bg-secondary rounded-pill">${(file.size/1024).toFixed(1)} KB</span>
                `;

                fileList.appendChild(li);
                });
            });

            // 處理上傳
            uploadBtn.addEventListener('click', async () => {
                if (!fileInput.files.length) {
                alert('請先選擇至少一個檔案！');
                return;
                }
                const formData = new FormData();
                Array.from(fileInput.files).forEach(f => formData.append('files', f));

                try {
                const resp = await fetch(`${serverAddress}/api/upload`, { method: 'POST', body: formData });
                if (!resp.ok) throw new Error(resp.statusText);
                const result = await resp.json();
                alert('上傳成功：' + JSON.stringify(result));
                fileInput.value = '';
                fileList.innerHTML = '';
                } catch (err) {
                console.error(err);
                alert('上傳失敗：' + err.message);
                }
            });
            </script>
        <script>
            // 等待 DOM 完全加載
            document.addEventListener('DOMContentLoaded', function () {
                // 取得表單和按鈕元素
                const form = document.querySelector('form');
                const uploadButton = document.getElementById('upload-button');
                const loadingButton = document.getElementById('loading-button');
            
                // 當表單提交時觸發
                form.addEventListener('submit', function (event) {
                // 隱藏上傳按鈕，顯示 Loading 按鈕
                uploadButton.style.display = 'none';
                loadingButton.style.display = 'inline-block';
                });
            });
            </script>
    </body>
</html>